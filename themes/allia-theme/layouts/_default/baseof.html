<!DOCTYPE html>
<html lang="{{ .Site.LanguageCode }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <meta name="theme-color" content="#272822">
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    <meta name="description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">

    <!-- Canonical URL -->
    <link rel="canonical" href="{{ .Permalink }}">

    <!-- Open Graph -->
    <meta property="og:title" content="{{ .Title }}">
    <meta property="og:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    <meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
    <meta property="og:url" content="{{ .Permalink }}">
    <meta property="og:site_name" content="{{ .Site.Title }}">
    {{ with .Params.image }}
    <meta property="og:image" content="{{ . | absURL }}">
    {{ else }}
    <meta property="og:image" content="{{ "images/og-default.png" | absURL }}">
    {{ end }}
    {{ if .IsPage }}
    <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
    {{ with .Params.author }}<meta property="article:author" content="{{ . }}">{{ end }}
    {{ range .Params.tags }}<meta property="article:tag" content="{{ . }}">{{ end }}
    {{ end }}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}">
    <meta name="twitter:description" content="{{ with .Description }}{{ . }}{{ else }}{{ .Site.Params.description }}{{ end }}">
    {{ with .Params.image }}
    <meta name="twitter:image" content="{{ . | absURL }}">
    {{ else }}
    <meta name="twitter:image" content="{{ "images/og-default.png" | absURL }}">
    {{ end }}

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ "favicon.png" | relURL }}">
    <link rel="apple-touch-icon" href="{{ "apple-touch-icon.png" | relURL }}">

    <!-- RSS -->
    {{ range .AlternativeOutputFormats -}}
        {{ printf `<link rel="%s" type="%s" href="%s" title="%s" />` .Rel .MediaType.Type .Permalink $.Site.Title | safeHTML }}
    {{ end -}}

    <!-- Google Fonts - Optimized loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}?v={{ now.Unix }}">

    <!-- Schema.org Structured Data -->
    {{ if .IsHome }}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebSite",
        "name": "{{ .Site.Title }}",
        "url": "{{ .Site.BaseURL }}",
        "description": "{{ .Site.Params.description }}",
        "publisher": {
            "@type": "Organization",
            "name": "Allia Studio",
            "url": "{{ .Site.BaseURL }}"
        },
        "inLanguage": "{{ .Site.LanguageCode }}"
    }
    </script>
    {{ else if .IsPage }}
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": {{ .Title | jsonify }},
        "description": {{ with .Description }}{{ . | jsonify }}{{ else }}{{ .Summary | plainify | truncate 160 | jsonify }}{{ end }},
        "url": {{ .Permalink | jsonify }},
        "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
        {{ with .Lastmod }}"dateModified": "{{ .Format "2006-01-02T15:04:05Z07:00" }}",{{ end }}
        "author": {
            "@type": "Person",
            "name": {{ with .Params.author }}{{ . | jsonify }}{{ else }}"Allia Studio"{{ end }}
        },
        "publisher": {
            "@type": "Organization",
            "name": "Allia Studio",
            "url": "{{ .Site.BaseURL }}"
        },
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": {{ .Permalink | jsonify }}
        },
        "keywords": [{{ range $i, $tag := .Params.tags }}{{ if $i }}, {{ end }}{{ $tag | jsonify }}{{ end }}],
        "inLanguage": "{{ .Site.LanguageCode }}"
    }
    </script>
    {{ end }}
</head>
<body>
    <!-- Skip to content for accessibility -->
    <a href="#main-content" class="skip-link">Saltar al contenido</a>

    <header class="site-header">
        <div class="container">
            <a href="{{ .Site.BaseURL }}" class="site-logo" aria-label="Inicio - Allia Blog">
                <span class="accent">~/</span> allia.blog
            </a>
            <nav class="site-nav" aria-label="Navegacion principal">
                {{ range .Site.Menus.main }}
                    {{ if hasPrefix .URL "http" }}
                    <a href="{{ .URL }}" class="external" target="_blank" rel="noopener" aria-label="{{ .Name }} (abre en nueva ventana)">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                        {{ .Name }}
                    </a>
                    {{ else }}
                    <a href="{{ .URL }}" {{ if hasPrefix $.RelPermalink .URL }}class="active" aria-current="page"{{ end }}>{{ .Name }}</a>
                    {{ end }}
                {{ end }}
            </nav>
        </div>
    </header>

    <main class="site-main" id="main-content">
        <div class="container">
            {{ block "main" . }}{{ end }}
        </div>
    </main>

    <footer class="site-footer">
        <div class="container">
            <span class="footer-copyright">&copy; {{ now.Year }} Allia Studio</span>
            <nav class="footer-links" aria-label="Enlaces del pie de pagina">
                {{ if .Site.Params.social.rss }}
                <a href="{{ "index.xml" | absURL }}" title="RSS Feed">RSS</a>
                {{ end }}
                {{ with .Site.Params.social.github }}
                <a href="{{ . }}" target="_blank" rel="noopener">GitHub</a>
                {{ end }}
                {{ with .Site.Params.social.twitter }}
                <a href="{{ . }}" target="_blank" rel="noopener">Twitter</a>
                {{ end }}
            </nav>
        </div>
    </footer>

    <script>
    // Copy button for code blocks with error handling
    document.addEventListener('DOMContentLoaded', function() {
        if (!navigator.clipboard) return;

        document.querySelectorAll('.copy-button').forEach(function(btn) {
            btn.addEventListener('click', function() {
                var pre = this.closest('pre');
                if (!pre) return;
                var code = pre.querySelector('code');
                if (!code) return;

                navigator.clipboard.writeText(code.textContent.trim())
                    .then(function() {
                        btn.textContent = 'copied!';
                        setTimeout(function() { btn.textContent = 'copy'; }, 2000);
                    })
                    .catch(function() {
                        btn.textContent = 'error';
                        setTimeout(function() { btn.textContent = 'copy'; }, 2000);
                    });
            });
        });
    });
    </script>
</body>
</html>
